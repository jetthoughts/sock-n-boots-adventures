var DEFAULT_Y=85;var DEFAULT_X=0;TEXTS=[[[{text:"Are you ever afraid of the dark at night?",time:3.5},{text:"Sock wants to tell you how he got over his fear of the dark",time:9}],[{text:"Book 1 Page 1 Text Line 1",x:5,y:75,time:3},{text:"Book 1 Page 1 Text Line 2",x:25,y:75,time:6},{text:"Book 1 Page 1 Text Line 3",x:25,y:75,time:10},{text:"Book 1 Page 1 Text Line 4",x:25,y:75,time:15}],[{text:"Book 1 Page 2 Text Line 1",x:20,y:60},{text:"Book 1 Page 2 Text Line 2",x:20,y:60}]],[[{text:"Are you ever afraid of the dark at night?",time:3.5},{text:"Sock wants to tell you how he got over his fear of the dark",time:9}],[{text:"At 8 o'clock Sock's house gets dark",time:8+5},{text:"The birds don't sing, and the dogs don't bark",time:8+11},{text:"<b>T</b>he whole neigborhood turns out their lights,",time:8+14},{text:"and they all go to sleep at night.",time:26}],[{text:"Tick..tock...tick...tock.",time:26+5.5},{text:"The clock strikes 8 and its bedtime for Sock",time:26+10},{text:"He'll get ready for bed, then he'll turn out his light,",time:26+14},{text:"but Sock is afraid of the dark at night",time:45}],[{text:"He pulls his covers up to his head,",time:45+3},{text:"and lies there shaking in his bed.",time:45+6.5},{text:"\"I'm scared, I'm scared\" Sock begins to shout.",time:45+11.5},{text:'"I don\'t like when the lights go out"',time:60}],[{text:"Sock doesn't like to turn out the light,",time:60+4},{text:"because the house makes scary noise at night.",time:60+8},{text:"Now it's dark inside Sock's room,",time:60+11},{text:"except for the light from the shining moon",time:75}],[{text:"Squeak.....squeak....... goes the floor.",time:75+5.5},{text:"Is that a noise coming from the closet door?",time:76+8},{text:"The very thought gives Sock a really big scare.",time:76+12},{text:"Could it be something hiding in there?",time:92}],[{text:"Sock says, \"there's a monster in my room,",time:92+3.5},{text:"and I know he'll try to eat me soon.\"",time:92+6},{text:"All is quiet from celing to floor.",time:92+11},{text:"Is there really a monster behind the door?",time:107}],[{text:"Sock is as curious as can be,",time:107+3},{text:"so he hops out of bed to go and see.",time:107+6},{text:"He opens the close and turns on the light,",time:107+10},{text:"and there are no monsters anywhere in sight.",time:121.3}],[{text:"Just to be sure Sock looks all around,",time:120+5},{text:"then he hops back in bed to sleep safe and sound.",time:120+11},{text:'"I\'m glad I checked for myself," says Sock.',time:120+15},{text:"\"Now I won't be afraid when it turns 8 o'clock. \"",time:140}],[{text:"So when Sock is afraid of the dark at night,",time:140+3.5},{text:"he just checks his whole room when he turns on the light.",time:140+9},{text:"Now Sock can sleep without a care,",time:140+13},{text:"because he knows there are no monsters there.",time:140+20}],[{text:"Now do you see how to get over",time:161},{text:"you fear of the dark",time:160+6}],[]],[[{text:"Should you be careful where you play?",time:2.5},{text:"Sock and Boots want to show you why you should be careful.",time:6.5},],[{text:"There are so many places to play in the house.",time:7+3.5},{text:"Even under the bed like a tiny mouse.",time:7+8},{text:"Sock wants to find a new place to play.",time:7+11.5},{text:"Just where will he play his games today?",time:23}],[{text:"Sock wants to play in the washing machine.",time:23+3},{text:"It spins and spins to get things clean.",time:23+8},{text:"Sock says to Boots, \"let's get inside,",time:23+11.5},{text:'it looks like fun... we can go for a ride."',time:39}],[{text:'"No," says Boots, "we can\'t ride."',time:39+3},{text:'"We might get hurt if we get inside."',time:39+7},{text:'"I think we should look for a different place"',time:39+11},{text:'"We should only play where we know it\'s safe"',time:54}],[{text:'Sock says, "Ill get in and have all the fun,',time:54+4},{text:"and you can just watch until I'm done",time:54+7},{text:"Boots starts to worry about his friend",time:54+12},{text:'"Don\'t do it,", says Boots, but Sock still climbs in',time:71}],[{text:"The washing machine locks as it rumbles and rumbles.",time:71+3.5},{text:"It fills up with water as Sock tumbles and tumbles.",time:71+8},{text:'"Help me Boots," Sock starts to scream,',time:71+11},{text:'"please get me out of this washing machine!"',time:87}],[{text:"Boots climbs up high and tugs on the door.",time:87+3.5},{text:"He tries and tries and tries some more.",time:87+7},{text:"The door won't open because it's locked.",time:87+11},{text:"So how will Boots get to poor little Sock?",time:102}],[{text:"Sock lets out another scream,",time:102+2.5},{text:'"please pull out the plug to the washing machine!"',time:102+7},{text:'"That\'s it!" says Boots, "but where is the plug?"',time:102+11},{text:"He looks all around even under the rug.",time:117}],[{text:'"There it is" Boots starts to shout.',time:118+3},{text:"He runs to the wall and yanks the plug out.",time:118+6},{text:"The washing machine stops and the door unlocks.",time:118+12},{text:"Boots has saved his best friend Sock.",time:134}],[{text:"Now Sock is safe, and he learned today,",time:134+3},{text:"that he s hould only play where it is safe to play.",time:134+9},{text:"Can you think of places that are not safe for you to play?",time:146.5},],[]]];var ttt;(function(b){var a=function(p,d,g,k,H){H=b.extend({background:"green",cornersTop:true,scale:"fit"},H);var h=this,S=p.prev(),M=0,R=false,P=H.background,e=H.cornersTop,Y=H.gradientColors||["#D1D1D1","#F5D7D5","#F2E2E1"],x=H.curlSize||0.1,N=H.scale,t=[],y=p.clone(),G=b.browser.msie?null:y[0].getContext("2d"),p=b.browser.msie?b(G_vmlCanvasManager.initElement(p[0])):p,A=p[0].getContext("2d"),I=0;var k=k.each(function(Z){if(t[Z]){return}var c=this;c.onload=function(){var aa=1;if(N!="noresize"){var ac=d/this.width,ab=g/this.height;if(N=="fit"){aa=(ac<1||ab<1)?Math.min(ac,ab):1}if(N=="fill"){aa=Math.min(ac,ab)}}b(c).data("flip.scale",aa);t[Z]=A.createPattern(c,"no-repeat");I++;if(I==k.length&&!R){R=true;W()}};if(c.complete){window.setTimeout(function(){c.onload()},10)}}).get();var d=d,g=g,F=d,D=g,i=F*(1-x),f=D*x,s=false,Q=b.browser.msie?p.offset():null,j=false,l=400,O=false,r,q,J=200,L=false,v,u,C,B,o=true,w=true,K=false,m=false;b(window).scroll(function(){});var X=b.browser.msie?(function(){var Z=b("<div>").width(d).height(g).css({position:"absolute",cursor:"default",zIndex:1}).appendTo("body");if(parseInt(b.browser.version)==7){Z.css({opacity:0.000001,background:"#FFF"})}var c=function(){Q=p.offset();return Z.css({left:Q.left+"px",top:Q.top+"px"})};b(window).resize(c);return c()})():p;X.mousemove(function(c){if(K){return}if(!Q){Q=p.offset()}if(w&&j&&(s&&(M>0)||(!s&&M<k.length-1))){if(!m){m=true;window.clearInterval(r)}F=!s?c.pageX-Q.left:d-(c.pageX-Q.left);D=e?c.pageY-Q.top:g-(c.pageY-Q.top);window.setTimeout(W,0);return false}C=c.pageX||C,B=c.pageY||B;if(!L){s=(((C-Q.left)<d/2&&M>0)||M==k.length-1)}if(!L&&((!s&&(C-Q.left)>i)||(s&&(C-Q.left)<(d-i)))&&((e&&(B-Q.top)<f)||(!e))){if(!j){j=true;X.css("cursor","pointer")}}else{if(j){j=false;X.css("cursor","default")}}return false}).bind("mouseenter",function(c){o=true;if(L){return}return false}).bind("mouseleave",function(c){return false}).click(function(){}).mousedown(function(c){m=false;w=true;return false}).mouseup(function(){w=false;if(j&&!L&&(s&&(M>0)||(!s&&M<k.length-1))){V()}return false});this.setDisabled=function(c){K=c},this.toFirstPage=function(){while(M>0){k.unshift(k.pop());t.unshift(t.pop());M--}W();L=false};var V=function(){L=true;X.triggerHandler("mousemove");window.clearInterval(r);q=new Date().getTime();v=F;u=D;r=window.setInterval(U,10);M+=s?-1:1;if(M<0){M=0}if(M==k.length){M=k.length-1}S.trigger("flip.jflip",[M,k.length])};this.nextPage=function(){w=false;s=false;if((s&&(M>0)||(!s&&M<k.length-1))){V()}};this.prevPage=function(){w=false;s=true;if((s&&(M>0)||(!s&&M<k.length-1))){V()}};var U=function(){var c=new Date(),Z=c.getTime()-q;if(Z>=J){window.clearInterval(r);if(s){k.unshift(k.pop());t.unshift(t.pop())}else{k.push(k.shift());t.push(t.shift())}F=d;D=g;W();L=false;if(o){}return}F=v-2*(d)*Z/J;D=u+2*(g)*Z/J;W()},n=function(){var c=new Date(),Z=c.getTime()-q;F=i+Math.sin(Math.PI*2*Z/1000);D=f+Math.cos(Math.PI*2*Z/1000);drawing=true;window.setTimeout(W,0)},z=function(){var c=new Date(),Z=c.getTime()-q;if(Z>=l){window.clearInterval(r);q=new Date().getTime();r=window.setInterval(n,10)}F=d-(d-i)*Z/l;D=f*Z/l;W()},T=function(){var c=new Date(),Z=c.getTime()-q;if(Z>=l){window.clearInterval(r)}F=i+(d-i)*Z/l;D=f-f*Z/l;W()},E=function(c,ab){var Z=c*d+ab,aa=-ab/c;if(b.browser.msie){Z=Math.round(Z);aa=Math.round(aa)}A.beginPath();A.moveTo(d,Math.min(Z,g));A.lineTo(d,0);A.lineTo(Math.max(aa,0),0);if(aa<0){A.lineTo(0,Math.min(ab,g));if(ab<g){A.lineTo((g-ab)/c,g)}A.lineTo(d,g)}else{if(Z<g){A.lineTo(d,Z)}else{A.lineTo((g-ab)/c,g);A.lineTo(d,g)}}},W=function(){if(!R){return}if(b.browser.msie){A.clearRect(0,0,d,g)}A.fillStyle=P;A.fillRect(0,0,d,g);var ad=k[0],Z=b(ad).data("flip.scale");A.drawImage(ad,0,0,d,g);if(D&&F!=d){var ab=2,aa=(D-ab*(F+d))/2;m2=D/(d-F),q2=F*m2;if(ab==m2){return}var al=1,ai=1,ae=0,ac=0;A.save();if(s){ae=d;al=-1}if(!e){ac=g;ai=-1}A.translate(ae,ac);A.scale(al,ai);var ao=(q2-aa)/(ab-m2);var am=ab*ao+aa;var ak=(2*am+ao+2*ab*F-2*D)/(2*ab+1);var ah=-ak/ab+am+ao/ab;var af=Math.sqrt(Math.pow(ao-ak,2)+Math.pow(am-ah,2));var an=Math.min(af*0.5,30);var ag;if(!(b.browser.mozilla&&parseFloat(b.browser.version)<1.9)){ag=A}else{ag=G;ag.clearRect(0,0,d,g);ag.save();ag.translate(1,0)}var aj=ag.createLinearGradient(ao,am,ak,ah);aj.addColorStop(0,Y[0]);aj.addColorStop(an/af,Y[1]);aj.addColorStop(1,Y[2]);ag.fillStyle=aj;ag.beginPath();ag.moveTo(-aa/ab,0);ag.quadraticCurveTo((-aa/ab+F)/2+0.02*F,D/2,F,D);ag.quadraticCurveTo((d+F)/2,(ab*d+aa+D)/2-0.02*(g-D),d,ab*d+aa);if(!(b.browser.mozilla&&parseFloat(b.browser.version)<1.9)){ag.fill()}else{ag.save();ag.clip();ag.fillRect(0,0,d,g);ag.restore();A.drawImage(y[0],0,0);ag.restore()}aj=null;A.fillStyle=P;E(ab,aa);A.fill();E(ab,aa);if(!b.browser.safari&&!b.browser.opera){A.restore()}var ad=s?k[k.length-1]:k[1];Z=b(ad).data("flip.scale");if(b.browser.msie){A.fillStyle=s?t[t.length-1]:t[1];A.fillStyle.width2=A.fillStyle.width*Z;A.fillStyle.height2=A.fillStyle.height*Z;A.fill()}else{A.save();A.clip();if(b.browser.safari||b.browser.opera){A.scale(1/al,1/ai);A.translate(-ae,-ac)}A.drawImage(ad,0,0,d,g);A.restore();if(b.browser.safari||b.browser.opera){A.restore()}}}}};b.fn.jFlip=function(d,c,e){return this.each(function(){b(this).wrap("<div class='flip_gallery'>");var f=b(this).find("img");var g=b(document.createElement("canvas")).attr({width:d,height:c}).css({margin:0,width:d+"px",height:c+"px"});b(this).css({position:"absolute",left:"-9000px",top:"-9000px"}).after(g);ttt=new a(b(this).next(),d||300,c||300,f,e);return ttt})}})(jQuery);var MENU_ANIMATION_DURATION=1000;var LIST_PAGE_DELAY=500;var NARRATION_START_DELAY=1000;var current_page=0;var current_story=-1;var autoplay_enabled=true;var audio_enabled=true;var narTimeout=null;var subIndex;var menuAnimating=false;var pageAnimating=false;var player=null;function stopNarration(){if(player!=null){player.stopNarration()}_setPlayLink()}function pauseNarration(){if(player==null){return false}if(player.pauseNarration()){_setPlayLink();return true}}function resumeNarration(){if(player==null){return false}if(!isNeedAudio()){return false}if(player.resumeNarration()){_setPauseLink();return true}}function requestNewTime(a){if(player==null){return false}if(player.seekNarration(a)){_setPauseLink()}}function playNarration(){if(!isNeedAudio()){return false}if(player!=null){player.playNarration()}_setPauseLink()}function init(){var a={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"};for(originalType in a){document.addEventListener(originalType,function(b){event=document.createEvent("MouseEvents");touch=b.changedTouches[0];event.initMouseEvent(a[b.type],true,true,window,0,touch.screenX,touch.screenY,touch.clientX,touch.clientY,touch.ctrlKey,touch.altKey,touch.shiftKey,touch.metaKey,0,null);b.target.dispatchEvent(event)})}$("#play_link.play").live("click",function(){resumeNarration()});$("#play_link.pause").live("click",function(){pauseNarration()});$("#story_board_link").click(function(){hidePages();$("#story_area").show();return false});$("#menu_trigger").click(function(){toggleMenu();return false});$("#menu_trigger").click(function(){toggleMenu();return false});$("#next").click(function(){if(!autoplay_enabled){nextPage()}return false});$("#prev").click(function(){if(!autoplay_enabled){prevPage()}return false});$("#main_menu_link").click(function(){hidePages();$("#main_menu_area").show();return false});$(".subs span .txt").live("click",function(f){if(player!=null&&player.audioStarting){return}if(autoplay_enabled){return}var b=TEXTS[current_story][current_page];if(f.offsetX>f.currentTarget.clientWidth/2){if(subIndex>=0&&subIndex<b.length-1){requestNewTime(b[subIndex].time)}nextSub()}else{prevSub();var c=subIndex-1;var d=getStartTime();if(c>=0&&c<b.length){d=b[c].time}requestNewTime(d)}})}function getStartTime(){var a=TEXTS[current_story][current_page-1]||[{time:0}];return a[a.length-1].time+0.001}function releasePlayer(){if(player!=null){player.release()}}function initPlayer(){if(audio_enabled){player=new StoryPlayer(true,function(){return{start_time:getStartTime()}})}}function hidePages(){hideSubs();releasePlayer();current_page=0;ttt.toFirstPage();$("#pages_area").hide()}function showPages(){ttt.setDisabled(autoplay_enabled);$("#story_area").hide();$("#pages_area").show();initPlayer();setPage(0)}function selectStory(a){if(a!=current_story){removeStory();setMenuOpacity(0,0);current_story=a;$("#story_area").css("background-image","url("+_coverImage("cover")+")");setupPages(function(){$("#book ul").jFlip(screenSize.width,screenSize.height,{background:"green",cornersTop:false}).bind("flip.jflip",function(d,b,c){pageDidChanged(b)});setupSubs()})}}function removeStory(){stopNarration();current_story=-1;$("#story_area").css("background-image","");$("#book").html("")}function removeSubs(){$(".subs").remove()}function hideSubs(){$(_currentSub()).find("span").hide()}function showSubs(){$(_currentSub()).find("span:first").show()}function setPage(a){stopNarration();hideSubs();current_page=a;subIndex=0;showSubs();(getPageCount()-1-a)?$("#next").show():$("#next").hide();a?$("#prev").show():$("#prev").hide();if(narTimeout!=null){clearTimeout(narTimeout)}if(isNeedAudio()){narTimeout=setTimeout("playNarration()",a?NARRATION_START_DELAY:0)}}function setupPages(c){var b=$("<ul id='pages'/>");var e=0;var a=new Array();for(var d=0;d<getPageCount();d++){a[d]=new Image();a[d].src=_pageImage(d+1);a[d].onload=function(){e++;if(e==getPageCount()){for(var f=0;f<getPageCount();f++){var g=$("<img />").attr("src",_pageImage(f+1));$(b).append($("<li id='"+_pageId(f)+"' />").append(g))}$("#book").append(b);c()}}}}function setupSubs(){removeSubs();var f=TEXTS[current_story];for(var d=0;d<f.length;d++){var c=$("<div />").addClass("subs");var b=f[d];for(var a=0;a<b.length;a++){var e=b[a];var g=$("<span />");$(g).append($("<p />").html(e.text).addClass("txt"));$(c).append(g)}$("#pages_area").append(c)}}function setMenuOpacity(b,a){$("#menu").animate({opacity:b},a);$("#nav a").animate({opacity:b},a)}function toggleMenu(){if(menuAnimating){return}var a;if($("#menu").css("opacity")==1){setMenuOpacity(0,MENU_ANIMATION_DURATION);a="+="}else{if($("#menu").css("opacity")==0){setMenuOpacity(1,MENU_ANIMATION_DURATION);a="-="}}var b=a+$("#menu").height()+"px";$(".subs span").animate({top:b},MENU_ANIMATION_DURATION);menuAnimating=true;setTimeout("menuAnimating=false",MENU_ANIMATION_DURATION*2)}function getPageCount(){return TEXTS[current_story].length}function isNeedAudio(){return hasSubs()&&audio_enabled}function hasSubs(){return TEXTS[current_story][current_page].length>0}function nextSub(){var c=$(_currentSub()).find("span:visible:first");var b=$(c).next();var a=b.length>0;if(a){subIndex++;$(c).hide();$(b).show()}return a}function prevSub(){var c=$(_currentSub()).find("span:visible:first");var b=$(c).prev();var a=b.length>0;if(a){subIndex--;$(c).hide();$(b).show()}return a}function prevPage(){if(pageAnimating){return}stopNarration();ttt.prevPage();pageAnimating=true;setTimeout("pageAnimating=false",LIST_PAGE_DELAY)}function nextPage(){if(pageAnimating){return}stopNarration();ttt.nextPage();pageAnimating=true;setTimeout("pageAnimating=false",LIST_PAGE_DELAY)}function pageDidChanged(a){if(a!=current_page){setPage(a)}}function positionDidChanged(a){var b=TEXTS[current_story][current_page];if(subIndex<0||subIndex>=b.length){return}if(a>=b[subIndex].time){if(!nextSub()){nextPage()}}}function _setPauseLink(){$("#play_link.play").removeClass("play").addClass("pause")}function _setPlayLink(){$("#play_link.pause").removeClass("pause").addClass("play")}function _currentSub(){return $(".subs:nth("+current_page+")")}function _pageId(a){return"page_"+current_story+"_"+a}function _pageImage(a){return"stories/"+(current_story+1)+"/images/"+_device()+"/"+a+".jpg"}function _getAudioRoot(){var a=_getRoot()+"stories/"+(current_story+1)+"/audio/";return a}function _getAudioPath(){var a=_getAudioRoot()+(current_page+1)+".wav";return a}function _device(){if(screenSize.width>480){return"ipad"}else{return"iphone"}}var screenSize;var options={audio_enabled:false,music_enabled:false};var home_audio=null;var homeAudioTimeout=null;function stopHomeAudio(){if(home_audio!=null){home_audio.stop()}}function playHomeAudio(){if(home_audio!=null){home_audio.play()}}function hideMainMenu(){clearTimeout(homeAudioTimeout);stopHomeAudio();$("#main_menu_area").hide();$("body").removeClass("main_menu")}function showMainMenu(){$("body").addClass("main_menu");$("#main_menu_area").show();homeAudioTimeout=setTimeout("playHomeAudio()",1000)}function hideStorybook(){$("#menu_area").hide();$("body").removeClass("story_book")}function showStorybook(){$("body").addClass("story_book");$("#menu_area").show()}function hideStoryMenu(){$("#story_area").hide();$("body").removeClass("story_menu")}function showStoryMenu(){$("body").addClass("story_menu");$("#story_area").show()}$(document).ready(function(){var a=$(window).width();var b=$(window).height();screenSize={width:a,height:b};$("#storybook_link").bind("click",function(){hideMainMenu();showStorybook();if(!$(".inventory-featured-default").hasClass("coverflow")){$("div.hproducts").coverflow({onSelectedFunc:function(c){hideStorybook();showStoryMenu();selectStory(Math.max(c,1));return false}})}return false});$("#help_link").bind("click",function(){return false});$(".hproduct").each(function(){$(this).find("img:first").attr("src","stories/"+(parseInt($(this).attr("rel"))+1)+"/images/"+_device()+"/cover_thumb.jpg")});$("#s_main_menu_link").bind("click",function(){hideStorybook();showMainMenu();return false});$("#s_options_link").bind("click",function(){$("#menu_area").hide();$("#options_area").show();return false});$("#s_buy_link").bind("click",function(){console.log("s_buy_link clicked");return false});$("#m_story_board_link").bind("click",function(){hideStoryMenu();showStorybook();removeStory();return false});$("#option_audio").change(function(){options.audio_enabled=$(this).is(":checked")});$("#option_music").change(function(){options.music_enabled=$(this).is(":checked")});$("#options_ok").bind("click",function(){$("#options_area").hide();$("#menu_area").show()});$("#with_audio_link").bind("click",function(){audio_enabled=true;autoplay_enabled=false;showPages();return false});$("#without_audio_link").bind("click",function(){audio_enabled=false;autoplay_enabled=false;showPages();return false});$("#auto_play_link").bind("click",function(){autoplay_enabled=true;showPages();return false})});var Player=function(c,a,b){this.audioFinishedHandler=a;this.positionHandler=b;var d=null;this.current_audio=new Media(c,function(){},function(){console.log("fail")});this.stopTimer=function(){if(d==null){return}clearInterval(d);d=null};this.startTimer=function(){this.stopTimer();var e=this;d=setInterval(function(){if(e.current_audio==null){e.stopTimer()}else{e.current_audio.getCurrentPosition(function(f){if(f<0){e.stopTimer();e.audioFinishedHandler()}else{e.positionHandler(f)}})}},1000)};this.play=function(e){this.stop();this.current_audio.play();this.startTimer()};this.stop=function(){this.stopTimer();if(this.current_audio!=null){this.current_audio.stop()}};this.release=function(){this.current_audio.stop();this.current_audio.release();this.current_audio=null};this.pause=function(){if(this.current_audio==null){return false}this.stopTimer();this.current_audio.pause();return true};this.resume=function(){if(this.current_audio==null){return false}else{this.current_audio.play();this.startTimer();return true}};this.seek=function(e){this.current_audio.seekTo(e*1000)}};var StoryPlayer=function(b,d){this.withMusic=b;this.bookInfo=d;this.audioStarting=false;var a=this.withMusic?"with_music.wav":"without_music.wav";var c=_getAudioRoot()+a;this.player=new Player(c,function(){},function(e){positionDidChanged(e)});this.playNarration=function(f){var e=this.bookInfo();this.player.seek(e.start_time);this.player.resume()};this.stopNarration=function(){this.player.pause()};this.release=function(){this.player.release()};this.pauseNarration=function(){return this.player.pause()};this.resumeNarration=function(){return this.player.resume()};this.seekNarration=function(f){if(!this.player.pause()){return false}this.audioStarting=true;var e=this;setTimeout(function(){e.player.seek(f);e.player.resume();e.audioStarting=false},500);return true}};(function(a){a.widget("ui.coverflow",{init:function(){a(".inventory-featured-default").addClass("coverflow");var b=this;this.callback=this.options.onSelectedFunc;this.items=a(this.options.items,this.element).bind("click",function(){if(a(this).attr("rel")==b.current){if(b.callback!=null){b.callback(b.current)}}else{b.moveTo(this);a("div.slider").slider("moveTo",b.current,null,true)}});this.itemWidth=this.items.outerWidth(true);a(document).bind("keydown",function(c){if(c.keyCode==39&&b.items.length>b.current+1){b.moveTo(b.current+1);a("div.slider").slider("moveTo",b.current,null,true)}if(c.keyCode==37&&b.current-1>=0){b.moveTo(b.current-1);a("div.slider").slider("moveTo",b.current,null,true)}});document.ontouchend=function(){};document.ontouchmove=function(c){if(Math.abs(c.touches[0].pageX-b.startX)>150){if((c.touches[0].pageX-b.startX)>5){b.swipeLeft=true}else{b.swipeLeft=false}b.swipe=true;if(b.swipeLeft&&b.swipe){b.moveTo(Math.max(b.current-1,0));a("div.slider").slider("moveTo",b.current,null,true)}else{if(b.swipe){b.moveTo(Math.min(b.current+1,2));a("div.slider").slider("moveTo",b.current,null,true)}}b.startX=c.touches[0].pageX;b.swipe=false}};document.ontouchstart=function(c){b.startX=c.touches[0].pageX;b.swipe=false};a("div.slider").slider({min:0,max:b.items.length-1,noKeyboard:true,slide:function(d,c){b.moveTo(c.value)}});this.current=0;this.refresh(1,0,this.current);this.element.css("left",(-this.current*this.itemWidth/2)+(this.element.parent()[0].offsetWidth/2-this.itemWidth/2)-(parseInt(this.element.css("paddingLeft"))||0))},moveTo:function(c){this.previous=this.current;this.current=!isNaN(parseInt(c))?parseInt(c):this.items.index(c);if(this.previous==this.current){return false}var b=this,d=Math.abs(b.previous-b.current)<=1?b.previous:b.current+(b.previous<b.current?-1:1);a.fx.step.coverflow=function(e){b.refresh(e.now,d,b.current)};this.element.stop().animate({coverflow:1,left:((-this.current*this.itemWidth/2)+(this.element.parent()[0].offsetWidth/2-this.itemWidth/2)-(parseInt(this.element.css("paddingLeft"))||0))},{duration:1000,easing:"easeOutQuint"})},refresh:function(c,f,e){var b=this,d=null;this.items.each(function(j){var h=(j==e&&f-e<0)||j-e>0?"left":"right";var g=j==e?(1-c):(j==f?c:1);var k=(j>f&&j!=e);var l="scale("+(1+((1-g)*0.1))+")  matrix(1, "+(h==="right"?-0.1:0.1)+", 0, 1, 0, 0)";if(j===b.current){l="scale(1.3)";mozTransform="scale(1.3)";a(".info").html(a(".fn",this).text())}else{mozTransform="scale(1)"}a(this).css({"-webkit-transform":l,"-moz-transform":mozTransform,left:((-j*(b.itemWidth/2))+(h=="right"?-b.itemWidth/2:b.itemWidth/2)*g),zIndex:b.items.length+(h=="left"?e-j:j-e)});if(!a.browser.msie){a(this).css("opacity",1-Math.abs((h=="left"?e-j:j-e))/8)}})}});a.extend(a.ui.coverflow,{defaults:{items:"> *",onSelectedFunc:null}})})(jQuery);